{% extends 'taskify/base.html' %} {% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2">
    <div class="card">
      <div
        class="card-header d-flex justify-content-between align-items-center"
      >
        <h2 class="mb-0">{{ task.title }}</h2>
        <span
          id="task-status"
          class="badge {% if task.completed %}bg-success{% else %}bg-warning{% endif %}"
        >
          {{ task.completed|yesno:"Completed,Pending" }}
        </span>
      </div>
      <div class="card-body">
        <p class="card-text">{{ task.description|linebreaks }}</p>
        <ul class="list-unstyled">
          <li><strong>Priority:</strong> {{ task.get_priority_display }}</li>
          <li>
            <strong>Due Date:</strong> {{ task.due_date|default:"No due date
            set" }}
          </li>
          <li><strong>Created:</strong> {{ task.created_date }}</li>
        </ul>
      </div>
      <div class="card-footer">
        <a href="{% url 'task_edit' pk=task.pk %}" class="btn btn-warning"
          >Edit</a
        >
        <a
          href="{% url 'task_delete' pk=task.pk %}"
          class="btn btn-danger"
          onclick="return confirm('Are you sure you want to delete this task?')"
          >Delete</a
        >
        <button id="toggle-completion" class="btn btn-success">
          {% if task.completed %}Mark as Incomplete{% else %}Mark as Complete{% endif %}
        </button>
        <a href="{% url 'task_list' %}" class="btn btn-secondary"
          >Back to List</a
        >
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('toggle-completion').addEventListener('click', function() {
    fetch("{% url 'task_toggle_completion' pk=task.pk %}", {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        const taskStatus = document.getElementById('task-status');
        const toggleButton = document.getElementById('toggle-completion');
        if (data.completed) {
            taskStatus.classList.remove('bg-warning');
            taskStatus.classList.add('bg-success');
            taskStatus.textContent = 'Completed';
            toggleButton.textContent = 'Mark as Incomplete';
        } else {
            taskStatus.classList.remove('bg-success');
            taskStatus.classList.add('bg-warning');
            taskStatus.textContent = 'Pending';
            toggleButton.textContent = 'Mark as Complete';
        }
    });
});
</script>
{% endblock %}